<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Playlist - Teste Funcional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .playlist-item {
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
        }
        .playlist-item:hover {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.15);
        }
        .status-loaded { color: #28a745; }
        .status-empty { color: #6c757d; }
        .btn-group .btn { margin-right: 4px; }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4><i class="fas fa-music me-2"></i>Sistema de Playlist - Face a Face com Deus</h4>
                        <p class="mb-0">Sistema funcional para gerenciar suas m√∫sicas</p>
                    </div>
                    <div class="card-body">
                        <!-- Controles -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" id="btnUploadMultiplo">
                                        <i class="fas fa-cloud-upload-alt me-2"></i>Upload M√∫ltiplo de M√∫sicas
                                    </button>
                                    <button class="btn btn-primary" id="btnAdicionarManual">
                                        <i class="fas fa-plus me-2"></i>Adicionar M√∫sica Manualmente
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-info" id="btnCarregarExemplo">
                                        <i class="fas fa-list me-2"></i>Carregar Lista de Exemplo
                                    </button>
                                    <button class="btn btn-danger" id="btnLimparTudo">
                                        <i class="fas fa-trash me-2"></i>Limpar Tudo
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="alert alert-info">
                            <div class="d-flex justify-content-between align-items-center">
                                <span><strong>Status da Playlist:</strong></span>
                                <span class="badge bg-primary" id="statusPlaylist">0 m√∫sicas</span>
                            </div>
                        </div>

                        <!-- Lista de M√∫sicas -->
                        <div id="containerPlaylist">
                            <div class="text-center py-5">
                                <i class="fas fa-music fa-4x text-muted mb-3"></i>
                                <h5 class="text-muted">Sua playlist est√° vazia</h5>
                                <p class="text-muted">Comece adicionando suas m√∫sicas favoritas!</p>
                            </div>
                        </div>

                        <!-- AutoMix Controls -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h6><i class="fas fa-magic me-2"></i>Controles AutoMix</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>Modo:</label>
                                        <select id="modoAutomix" class="form-select">
                                            <option value="sequencial">Sequencial</option>
                                            <option value="aleatorio">Aleat√≥rio</option>
                                            <option value="loop">Loop</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Intervalo (segundos):</label>
                                        <input type="number" id="intervaloAutomix" class="form-control" value="30" min="10" max="300">
                                    </div>
                                    <div class="col-md-4">
                                        <label>A√ß√£o:</label>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-success" id="btnIniciarAutomix">
                                                <i class="fas fa-play"></i> Iniciar
                                            </button>
                                            <button class="btn btn-danger" id="btnPararAutomix" disabled>
                                                <i class="fas fa-stop"></i> Parar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        Status: <span id="statusAutomix" class="badge bg-secondary">Parado</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let playlist = [];
        let automixAtivo = false;
        let automixInterval = null;
        let indiceAtual = 0;

        // Elementos DOM
        const containerPlaylist = document.getElementById('containerPlaylist');
        const statusPlaylist = document.getElementById('statusPlaylist');
        const statusAutomix = document.getElementById('statusAutomix');

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Sistema de Playlist Iniciado');
            inicializarEventos();
            atualizarInterface();
        });

        function inicializarEventos() {
            console.log('üìã Inicializando eventos...');
            
            document.getElementById('btnUploadMultiplo').addEventListener('click', uploadMultiplo);
            document.getElementById('btnAdicionarManual').addEventListener('click', adicionarManual);
            document.getElementById('btnCarregarExemplo').addEventListener('click', carregarExemplo);
            document.getElementById('btnLimparTudo').addEventListener('click', limparTudo);
            document.getElementById('btnIniciarAutomix').addEventListener('click', iniciarAutomix);
            document.getElementById('btnPararAutomix').addEventListener('click', pararAutomix);
            
            console.log('‚úÖ Eventos inicializados');
        }

        function uploadMultiplo() {
            console.log('üéµ Upload m√∫ltiplo iniciado');
            
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'audio/*';
            
            input.onchange = function(event) {
                const arquivos = Array.from(event.target.files);
                console.log(`üìÅ ${arquivos.length} arquivo(s) selecionado(s)`);
                
                let sucessos = 0;
                
                arquivos.forEach((arquivo, index) => {
                    console.log(`üéß Processando: ${arquivo.name} (${arquivo.type})`);
                    
                    if (arquivo.type.startsWith('audio/')) {
                        const nomeArquivo = arquivo.name.replace(/\\.[^/.]+$/, "");
                        const partes = nomeArquivo.split(' - ');
                        
                        let titulo, artista;
                        if (partes.length >= 2) {
                            artista = partes[0].trim();
                            titulo = partes.slice(1).join(' - ').trim();
                        } else {
                            titulo = nomeArquivo;
                            artista = 'Artista Desconhecido';
                        }
                        
                        const url = URL.createObjectURL(arquivo);
                        
                        const novaMusica = {
                            id: Date.now() + index,
                            titulo: titulo,
                            artista: artista,
                            arquivo: arquivo,
                            url: url,
                            duracao: '0:00',
                            carregada: true
                        };
                        
                        playlist.push(novaMusica);
                        sucessos++;
                        
                        console.log(`‚úÖ Adicionada: ${titulo} - ${artista}`);
                        
                        // Obter dura√ß√£o
                        obterDuracao(novaMusica);
                    } else {
                        console.log(`‚ùå Arquivo inv√°lido: ${arquivo.name}`);
                    }
                });
                
                atualizarInterface();
                
                if (sucessos > 0) {
                    alert(`‚úÖ ${sucessos} m√∫sica(s) adicionada(s) com sucesso!`);
                } else {
                    alert('‚ùå Nenhum arquivo de √°udio v√°lido foi selecionado.');
                }
            };
            
            input.click();
        }

        function adicionarManual() {
            console.log('‚úèÔ∏è Adi√ß√£o manual iniciada');
            
            const titulo = prompt('Digite o t√≠tulo da m√∫sica:');
            if (!titulo) return;
            
            const artista = prompt('Digite o nome do artista:') || 'Artista Desconhecido';
            
            const novaMusica = {
                id: Date.now(),
                titulo: titulo,
                artista: artista,
                arquivo: null,
                url: '',
                duracao: '0:00',
                carregada: false
            };
            
            playlist.push(novaMusica);
            atualizarInterface();
            
            console.log(`‚úÖ M√∫sica manual adicionada: ${titulo} - ${artista}`);
            alert(`‚úÖ M√∫sica "${titulo}" adicionada √† playlist!`);
        }

        function carregarExemplo() {
            console.log('üìã Carregando playlist de exemplo');
            
            if (!confirm('Deseja carregar uma playlist de exemplo com m√∫sicas crist√£s?')) {
                return;
            }
            
            const exemplos = [
                { titulo: 'Amazing Grace', artista: 'Traditional', duracao: '4:15' },
                { titulo: 'Rude Cruz', artista: 'Hin√°rio Adventista', duracao: '4:30' },
                { titulo: 'Oceanos', artista: 'Hillsong United', duracao: '6:45' },
                { titulo: 'Como √© Grande o Meu Deus', artista: 'Hillsong', duracao: '5:20' },
                { titulo: 'Tua Gra√ßa me Basta', artista: 'Fernandinho', duracao: '4:50' }
            ];
            
            exemplos.forEach((exemplo, index) => {
                playlist.push({
                    id: Date.now() + index,
                    titulo: exemplo.titulo,
                    artista: exemplo.artista,
                    arquivo: null,
                    url: '',
                    duracao: exemplo.duracao,
                    carregada: false,
                    exemplo: true
                });
            });
            
            atualizarInterface();
            console.log(`‚úÖ ${exemplos.length} m√∫sicas de exemplo adicionadas`);
            alert('‚úÖ Playlist de exemplo carregada! Use os bot√µes de upload para adicionar arquivos.');
        }

        function limparTudo() {
            console.log('üóëÔ∏è Limpando playlist');
            
            if (!confirm('Tem certeza que deseja limpar toda a playlist?')) {
                return;
            }
            
            // Liberar URLs da mem√≥ria
            playlist.forEach(musica => {
                if (musica.url) {
                    URL.revokeObjectURL(musica.url);
                }
            });
            
            playlist = [];
            indiceAtual = 0;
            
            if (automixAtivo) {
                pararAutomix();
            }
            
            atualizarInterface();
            console.log('‚úÖ Playlist limpa');
            alert('‚úÖ Playlist limpa com sucesso!');
        }

        function removerMusica(id) {
            console.log(`üóëÔ∏è Removendo m√∫sica ID: ${id}`);
            
            const index = playlist.findIndex(m => m.id === id);
            if (index === -1) return;
            
            const musica = playlist[index];
            if (!confirm(`Remover "${musica.titulo}" da playlist?`)) {
                return;
            }
            
            // Liberar URL da mem√≥ria
            if (musica.url) {
                URL.revokeObjectURL(musica.url);
            }
            
            playlist.splice(index, 1);
            
            // Ajustar √≠ndice atual
            if (indiceAtual >= index) {
                indiceAtual = Math.max(0, indiceAtual - 1);
            }
            
            atualizarInterface();
            console.log(`‚úÖ M√∫sica removida: ${musica.titulo}`);
        }

        function carregarArquivo(id) {
            console.log(`üìÅ Carregando arquivo para m√∫sica ID: ${id}`);
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'audio/*';
            
            input.onchange = function(event) {
                const arquivo = event.target.files[0];
                if (!arquivo || !arquivo.type.startsWith('audio/')) {
                    alert('Por favor, selecione um arquivo de √°udio v√°lido.');
                    return;
                }
                
                const musica = playlist.find(m => m.id === id);
                if (!musica) return;
                
                // Liberar URL anterior
                if (musica.url) {
                    URL.revokeObjectURL(musica.url);
                }
                
                musica.arquivo = arquivo;
                musica.url = URL.createObjectURL(arquivo);
                musica.carregada = true;
                
                atualizarInterface();
                obterDuracao(musica);
                
                console.log(`‚úÖ Arquivo carregado para: ${musica.titulo}`);
                alert(`‚úÖ Arquivo "${arquivo.name}" carregado!`);
            };
            
            input.click();
        }

        function obterDuracao(musica) {
            if (!musica.url) return;
            
            const audio = new Audio(musica.url);
            audio.addEventListener('loadedmetadata', () => {
                const minutos = Math.floor(audio.duration / 60);
                const segundos = Math.floor(audio.duration % 60);
                musica.duracao = `${minutos}:${segundos.toString().padStart(2, '0')}`;
                atualizarInterface();
            });
            audio.load();
        }

        function atualizarInterface() {
            console.log('üîÑ Atualizando interface...');
            
            // Atualizar contador
            const carregadas = playlist.filter(m => m.carregada).length;
            const total = playlist.length;
            
            if (total === 0) {
                statusPlaylist.textContent = 'Vazia';
                statusPlaylist.className = 'badge bg-secondary';
            } else if (carregadas === total) {
                statusPlaylist.textContent = `${total} m√∫sica${total > 1 ? 's' : ''} (todas prontas)`;
                statusPlaylist.className = 'badge bg-success';
            } else {
                statusPlaylist.textContent = `${carregadas}/${total} carregada${carregadas !== 1 ? 's' : ''}`;
                statusPlaylist.className = 'badge bg-warning';
            }
            
            // Renderizar lista
            if (playlist.length === 0) {
                containerPlaylist.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-music fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">Sua playlist est√° vazia</h5>
                        <p class="text-muted">Comece adicionando suas m√∫sicas favoritas!</p>
                    </div>
                `;
            } else {
                let html = '';
                playlist.forEach((musica, index) => {
                    const statusIcon = musica.carregada ? 'fas fa-check-circle status-loaded' : 'fas fa-circle status-empty';
                    const exemploTag = musica.exemplo ? '<span class="badge bg-info ms-2">Exemplo</span>' : '';
                    const atualTag = index === indiceAtual ? '<span class="badge bg-primary ms-2">Atual</span>' : '';
                    
                    html += `
                        <div class="playlist-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-1">
                                        <i class="${statusIcon} me-2"></i>
                                        <strong>${musica.titulo}</strong>
                                        ${atualTag}
                                        ${exemploTag}
                                    </div>
                                    <small class="text-muted">
                                        ${musica.artista} ‚Ä¢ ${musica.duracao}
                                    </small>
                                </div>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-primary" onclick="carregarArquivo(${musica.id})" title="Carregar arquivo">
                                        <i class="fas fa-upload"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="reproduzirMusica(${musica.id})" 
                                            ${!musica.carregada ? 'disabled' : ''} title="Reproduzir">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="removerMusica(${musica.id})" title="Remover">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                containerPlaylist.innerHTML = html;
            }
            
            console.log('‚úÖ Interface atualizada');
        }

        function reproduzirMusica(id) {
            const musica = playlist.find(m => m.id === id);
            if (!musica || !musica.carregada) return;
            
            console.log(`üéµ Reproduzindo: ${musica.titulo}`);
            
            // Simular reprodu√ß√£o (aqui voc√™ integraria com os decks)
            indiceAtual = playlist.findIndex(m => m.id === id);
            atualizarInterface();
            
            alert(`üéµ Reproduzindo: "${musica.titulo}" - ${musica.artista}`);
        }

        function iniciarAutomix() {
            console.log('üéõÔ∏è Iniciando AutoMix');
            
            const musicasCarregadas = playlist.filter(m => m.carregada);
            if (musicasCarregadas.length === 0) {
                alert('‚ùå Carregue pelo menos uma m√∫sica antes de iniciar o AutoMix.');
                return;
            }
            
            automixAtivo = true;
            const intervalo = parseInt(document.getElementById('intervaloAutomix').value) * 1000;
            
            document.getElementById('btnIniciarAutomix').disabled = true;
            document.getElementById('btnPararAutomix').disabled = false;
            statusAutomix.textContent = 'Ativo';
            statusAutomix.className = 'badge bg-success';
            
            automixInterval = setInterval(() => {
                proximaMusica();
            }, intervalo);
            
            // Tocar primeira m√∫sica
            proximaMusica();
            
            console.log(`‚úÖ AutoMix iniciado com intervalo de ${intervalo/1000}s`);
        }

        function pararAutomix() {
            console.log('‚èπÔ∏è Parando AutoMix');
            
            automixAtivo = false;
            
            if (automixInterval) {
                clearInterval(automixInterval);
                automixInterval = null;
            }
            
            document.getElementById('btnIniciarAutomix').disabled = false;
            document.getElementById('btnPararAutomix').disabled = true;
            statusAutomix.textContent = 'Parado';
            statusAutomix.className = 'badge bg-secondary';
            
            console.log('‚úÖ AutoMix parado');
        }

        function proximaMusica() {
            const musicasCarregadas = playlist.filter(m => m.carregada);
            if (musicasCarregadas.length === 0) return;
            
            const modo = document.getElementById('modoAutomix').value;
            
            switch (modo) {
                case 'aleatorio':
                    const randomIndex = Math.floor(Math.random() * musicasCarregadas.length);
                    const randomMusica = musicasCarregadas[randomIndex];
                    indiceAtual = playlist.findIndex(m => m.id === randomMusica.id);
                    break;
                    
                case 'loop':
                case 'sequencial':
                default:
                    do {
                        indiceAtual = (indiceAtual + 1) % playlist.length;
                    } while (!playlist[indiceAtual].carregada && musicasCarregadas.length > 0);
                    break;
            }
            
            const musicaAtual = playlist[indiceAtual];
            if (musicaAtual && musicaAtual.carregada) {
                console.log(`üéµ AutoMix tocando: ${musicaAtual.titulo}`);
                atualizarInterface();
                // Aqui integraria com o sistema de decks
            }
        }

        // Fun√ß√£o global para teste
        window.testarSistema = function() {
            console.log('üß™ TESTE DO SISTEMA');
            console.log('Playlist atual:', playlist);
            console.log('AutoMix ativo:', automixAtivo);
            console.log('√çndice atual:', indiceAtual);
            
            // Adicionar m√∫sica de teste
            adicionarManual();
        };

        console.log('üéâ Sistema de Playlist carregado! Digite testarSistema() para teste.');
    </script>
</body>
</html>
