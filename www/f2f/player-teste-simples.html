<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Teste Simples - F2F</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .player-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            margin: 20px 0;
            padding: 20px;
        }
        .deck-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">
                    <i class="fas fa-music me-2"></i>
                    Player Teste Simples - F2F
                </h1>
            </div>
        </div>

        <div class="row">
            <!-- Deck 1 -->
            <div class="col-md-6">
                <div class="deck-container">
                    <h4><i class="fas fa-record-vinyl me-2"></i>Deck 1</h4>
                    <div class="mb-3">
                        <input type="file" class="form-control" id="file1" accept="audio/*">
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary btn-lg" id="play1" onclick="togglePlay(1)">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="stop(1)">
                            <i class="fas fa-stop"></i>
                        </button>
                    </div>
                    <div class="mt-3">
                        <label>Volume:</label>
                        <input type="range" class="form-range" min="0" max="1" step="0.1" value="0.7" id="volume1" onchange="setVolume(1, this.value)">
                    </div>
                    <div class="mt-2">
                        <small id="info1" class="text-muted">Nenhum arquivo carregado</small>
                    </div>
                </div>
            </div>

            <!-- Deck 2 -->
            <div class="col-md-6">
                <div class="deck-container">
                    <h4><i class="fas fa-record-vinyl me-2"></i>Deck 2</h4>
                    <div class="mb-3">
                        <input type="file" class="form-control" id="file2" accept="audio/*">
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary btn-lg" id="play2" onclick="togglePlay(2)">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="stop(2)">
                            <i class="fas fa-stop"></i>
                        </button>
                    </div>
                    <div class="mt-3">
                        <label>Volume:</label>
                        <input type="range" class="form-range" min="0" max="1" step="0.1" value="0.7" id="volume2" onchange="setVolume(2, this.value)">
                    </div>
                    <div class="mt-2">
                        <small id="info2" class="text-muted">Nenhum arquivo carregado</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Playlist Simples -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="player-container">
                    <h4><i class="fas fa-list-music me-2"></i>Playlist Simples</h4>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="file" class="form-control" id="playlistFiles" multiple accept="audio/*">
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-success" onclick="loadPlaylistFiles()">
                                <i class="fas fa-plus me-1"></i>Adicionar M√∫sicas
                            </button>
                            <button class="btn btn-info ms-2" onclick="testSystem()">
                                <i class="fas fa-test-tube me-1"></i>Testar Sistema
                            </button>
                        </div>
                    </div>

                    <div id="playlistContainer" class="mt-3">
                        <!-- Playlist ser√° preenchida aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Objetos dos decks
        const decks = {
            1: { audio: null, isPlaying: false, file: null },
            2: { audio: null, isPlaying: false, file: null }
        };

        // Playlist simples
        let playlist = [];

        // Inicializar eventos de arquivo
        document.getElementById('file1').addEventListener('change', (e) => loadFile(1, e.target.files[0]));
        document.getElementById('file2').addEventListener('change', (e) => loadFile(2, e.target.files[0]));

        // Carregar arquivo no deck
        function loadFile(deckNumber, file) {
            if (!file) return;

            console.log(`üìÅ Carregando arquivo no Deck ${deckNumber}:`, file.name);
            
            const deck = decks[deckNumber];
            const url = URL.createObjectURL(file);
            
            // Criar novo elemento de √°udio
            if (deck.audio) {
                deck.audio.pause();
                URL.revokeObjectURL(deck.audio.src);
            }
            
            deck.audio = new Audio(url);
            deck.file = file;
            deck.isPlaying = false;
            
            // Atualizar interface
            document.getElementById(`info${deckNumber}`).textContent = file.name;
            
            // Reset bot√£o play
            const playBtn = document.getElementById(`play${deckNumber}`);
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            playBtn.className = 'btn btn-primary btn-lg';
            
            console.log(`‚úÖ Arquivo carregado no Deck ${deckNumber}`);
        }

        // Alternar play/pause
        function togglePlay(deckNumber) {
            const deck = decks[deckNumber];
            const playBtn = document.getElementById(`play${deckNumber}`);
            
            if (!deck.audio) {
                alert(`Carregue um arquivo no Deck ${deckNumber} primeiro!`);
                return;
            }
            
            if (deck.isPlaying) {
                deck.audio.pause();
                deck.isPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.className = 'btn btn-primary btn-lg';
                console.log(`‚è∏Ô∏è Deck ${deckNumber} pausado`);
            } else {
                deck.audio.play();
                deck.isPlaying = true;
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playBtn.className = 'btn btn-warning btn-lg';
                console.log(`‚ñ∂Ô∏è Deck ${deckNumber} tocando`);
            }
        }

        // Parar reprodu√ß√£o
        function stop(deckNumber) {
            const deck = decks[deckNumber];
            const playBtn = document.getElementById(`play${deckNumber}`);
            
            if (deck.audio) {
                deck.audio.pause();
                deck.audio.currentTime = 0;
                deck.isPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.className = 'btn btn-primary btn-lg';
                console.log(`‚èπÔ∏è Deck ${deckNumber} parado`);
            }
        }

        // Definir volume
        function setVolume(deckNumber, volume) {
            const deck = decks[deckNumber];
            if (deck.audio) {
                deck.audio.volume = volume;
                console.log(`üîä Volume Deck ${deckNumber}: ${Math.round(volume * 100)}%`);
            }
        }

        // Carregar arquivos da playlist
        function loadPlaylistFiles() {
            const files = document.getElementById('playlistFiles').files;
            
            if (files.length === 0) {
                alert('Selecione arquivos de √°udio primeiro!');
                return;
            }
            
            console.log(`üìã Carregando ${files.length} arquivo(s) na playlist`);
            
            playlist = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                playlist.push({
                    id: i,
                    title: file.name.replace(/\.[^/.]+$/, ""),
                    artist: "Artista Desconhecido",
                    file: file
                });
            }
            
            renderPlaylist();
            console.log(`‚úÖ Playlist carregada com ${playlist.length} m√∫sica(s)`);
        }

        // Renderizar playlist
        function renderPlaylist() {
            const container = document.getElementById('playlistContainer');
            
            if (playlist.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Nenhuma m√∫sica na playlist</div>';
                return;
            }
            
            let html = '<div class="list-group">';
            
            playlist.forEach((track, index) => {
                html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center bg-dark text-white">
                        <div>
                            <strong>${track.title}</strong><br>
                            <small class="text-muted">${track.artist}</small>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-success me-2" onclick="playFromPlaylist(${index})">
                                <i class="fas fa-play"></i> Tocar
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="loadToAvailableDeck(${index})">
                                <i class="fas fa-upload"></i> Carregar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Encontrar deck dispon√≠vel
        function findAvailableDeck() {
            for (let i = 1; i <= 2; i++) {
                if (!decks[i].isPlaying) {
                    console.log(`‚úÖ Deck ${i} dispon√≠vel`);
                    return i;
                }
            }
            
            console.log('‚ö†Ô∏è Todos os decks ocupados, usando Deck 1');
            return 1; // For√ßar uso do deck 1
        }

        // Carregar m√∫sica no deck dispon√≠vel
        function loadToAvailableDeck(index) {
            const track = playlist[index];
            const deckNumber = findAvailableDeck();
            
            console.log(`üéµ Carregando "${track.title}" no Deck ${deckNumber}`);
            
            // Simular input de arquivo
            const fileInput = document.getElementById(`file${deckNumber}`);
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(track.file);
            fileInput.files = dataTransfer.files;
            
            // Disparar evento change
            const event = new Event('change', { bubbles: true });
            fileInput.dispatchEvent(event);
            
            console.log(`‚úÖ M√∫sica carregada no Deck ${deckNumber}`);
        }

        // Tocar m√∫sica da playlist
        function playFromPlaylist(index) {
            const track = playlist[index];
            const deckNumber = findAvailableDeck();
            
            console.log(`üéµ Tocando "${track.title}" no Deck ${deckNumber}`);
            
            // Parar deck se estiver tocando
            if (decks[deckNumber].isPlaying) {
                stop(deckNumber);
            }
            
            // Carregar arquivo
            loadFile(deckNumber, track.file);
            
            // Tocar ap√≥s um delay
            setTimeout(() => {
                togglePlay(deckNumber);
            }, 500);
        }

        // Fun√ß√£o de teste do sistema
        function testSystem() {
            console.log('üîß === TESTE DO SISTEMA SIMPLES ===');
            
            // Verificar decks
            for (let i = 1; i <= 2; i++) {
                const deck = decks[i];
                const input = document.getElementById(`file${i}`);
                console.log(`üéõÔ∏è Deck ${i}:`, {
                    hasAudio: !!deck.audio,
                    isPlaying: deck.isPlaying,
                    hasFile: !!deck.file,
                    inputFiles: input.files.length
                });
            }
            
            // Verificar playlist
            console.log('üìã Playlist:', {
                count: playlist.length,
                tracks: playlist.map(t => t.title)
            });
            
            // Testar primeira m√∫sica se dispon√≠vel
            if (playlist.length > 0) {
                console.log('üéµ Testando primeira m√∫sica...');
                playFromPlaylist(0);
            } else {
                console.log('‚ùå Playlist vazia - adicione m√∫sicas primeiro');
            }
            
            console.log('üîß === FIM DO TESTE ===');
        }

        console.log('üéµ Player Teste Simples carregado!');
        console.log('üîß Para testar, execute: testSystem()');
    </script>
</body>
</html>
