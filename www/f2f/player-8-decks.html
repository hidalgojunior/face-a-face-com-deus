<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player 8 Decks - F2F</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .player-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            margin: 20px 0;
            padding: 20px;
        }
        .deck-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .deck-container.playing {
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
        }
        .deck-title {
            color: #ffc107;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .deck-info {
            font-size: 0.85em;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        .volume-control {
            margin: 10px 0;
        }
        .volume-display {
            font-size: 0.8em;
            color: #ffc107;
        }
        @media (max-width: 768px) {
            .deck-container {
                padding: 10px;
            }
            .control-buttons .btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">
                    <i class="fas fa-music me-2"></i>
                    Player 8 Decks - Face a Face com Deus
                </h1>
            </div>
        </div>

        <!-- Master Controls -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="player-container">
                    <h4><i class="fas fa-sliders-h me-2"></i>Controles Gerais</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-success me-2" onclick="stopAll()">
                                <i class="fas fa-stop me-1"></i>Parar Todos
                            </button>
                            <button class="btn btn-warning me-2" onclick="pauseAll()">
                                <i class="fas fa-pause me-1"></i>Pausar Todos
                            </button>
                            <button class="btn btn-info" onclick="testSystem()">
                                <i class="fas fa-test-tube me-1"></i>Testar Sistema
                            </button>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <label class="me-2">Volume Geral:</label>
                                <input type="range" class="form-range" min="0" max="1" step="0.1" value="0.7" id="masterVolume" onchange="setMasterVolume(this.value)">
                                <span class="ms-2 volume-display" id="masterVolumeDisplay">70%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Decks Grid -->
        <div class="row" id="decksContainer">
            <!-- Os 8 decks ser√£o criados aqui pelo JavaScript -->
        </div>

        <!-- Playlist -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="player-container">
                    <h4><i class="fas fa-list-music me-2"></i>Playlist Avan√ßada (8 Decks)</h4>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="file" class="form-control" id="playlistFiles" multiple accept="audio/*">
                        </div>
                        <div class="col-md-8">
                            <button class="btn btn-success me-2" onclick="loadPlaylistFiles()">
                                <i class="fas fa-plus me-1"></i>Adicionar M√∫sicas
                            </button>
                            <button class="btn btn-info me-2" onclick="testSystem()">
                                <i class="fas fa-test-tube me-1"></i>Testar Sistema
                            </button>
                            <button class="btn btn-warning me-2" onclick="playNextSongs()">
                                <i class="fas fa-forward me-1"></i>Tocar Pr√≥ximas 8
                            </button>
                            <button class="btn btn-danger" onclick="clearPlaylist()">
                                <i class="fas fa-trash me-1"></i>Limpar Playlist
                            </button>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="alert alert-info" id="playlistStatus">
                                Playlist vazia - Adicione m√∫sicas acima
                            </div>
                        </div>
                    </div>

                    <div id="playlistContainer" class="mt-3">
                        <!-- Playlist ser√° preenchida aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o dos 8 decks
        const decks = {};
        let playlist = [];
        let masterVolume = 0.7;

        // Inicializar os 8 decks
        function initializeDecks() {
            const container = document.getElementById('decksContainer');
            let html = '';

            for (let i = 1; i <= 8; i++) {
                // Criar objeto do deck
                decks[i] = { 
                    audio: null, 
                    isPlaying: false, 
                    file: null,
                    volume: 0.7
                };

                // Criar HTML do deck
                html += `
                    <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                        <div class="deck-container" id="deckContainer${i}">
                            <h5 class="deck-title">
                                <i class="fas fa-record-vinyl me-2"></i>
                                Deck ${i}
                                <span class="badge bg-secondary float-end" id="deckStatus${i}">Vazio</span>
                            </h5>
                            
                            <div class="mb-3">
                                <input type="file" class="form-control form-control-sm" id="file${i}" accept="audio/*">
                            </div>
                            
                            <div class="control-buttons mb-3">
                                <button class="btn btn-primary" id="play${i}" onclick="togglePlay(${i})">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="btn btn-secondary" onclick="stop(${i})">
                                    <i class="fas fa-stop"></i>
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="loadRandom(${i})">
                                    <i class="fas fa-random"></i>
                                </button>
                            </div>
                            
                            <div class="volume-control">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-volume-up me-2"></i>
                                    <input type="range" class="form-range" min="0" max="1" step="0.1" value="0.7" 
                                           id="volume${i}" onchange="setVolume(${i}, this.value)">
                                    <span class="ms-2 volume-display" id="volumeDisplay${i}">70%</span>
                                </div>
                            </div>
                            
                            <div class="deck-info">
                                <small id="info${i}" class="text-muted">Nenhum arquivo carregado</small>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;

            // Adicionar event listeners para os inputs de arquivo
            for (let i = 1; i <= 8; i++) {
                document.getElementById(`file${i}`).addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        loadFile(i, e.target.files[0]);
                    }
                });
            }
        }

        // Carregar arquivo no deck
        function loadFile(deckNumber, file) {
            if (!file) return;

            console.log(`üìÅ Carregando arquivo no Deck ${deckNumber}:`, file.name);
            
            const deck = decks[deckNumber];
            const url = URL.createObjectURL(file);
            
            // Limpar √°udio anterior
            if (deck.audio) {
                deck.audio.pause();
                URL.revokeObjectURL(deck.audio.src);
            }
            
            // Criar novo elemento de √°udio
            deck.audio = new Audio(url);
            deck.file = file;
            deck.isPlaying = false;
            deck.audio.volume = deck.volume * masterVolume;
            
            // Event listeners do √°udio
            deck.audio.addEventListener('ended', () => {
                console.log(`üîÑ Deck ${deckNumber} finalizou`);
                stop(deckNumber);
            });

            deck.audio.addEventListener('loadeddata', () => {
                const duration = formatTime(deck.audio.duration);
                document.getElementById(`info${deckNumber}`).innerHTML = `
                    <strong>${file.name}</strong><br>
                    <span class="text-info">Dura√ß√£o: ${duration}</span>
                `;
            });
            
            // Atualizar interface
            document.getElementById(`deckStatus${deckNumber}`).textContent = 'Carregado';
            document.getElementById(`deckStatus${deckNumber}`).className = 'badge bg-success float-end';
            
            // Reset bot√£o play
            const playBtn = document.getElementById(`play${deckNumber}`);
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            playBtn.className = 'btn btn-primary';
            
            // Remover classe playing do container
            document.getElementById(`deckContainer${deckNumber}`).classList.remove('playing');
            
            console.log(`‚úÖ Arquivo carregado no Deck ${deckNumber}`);
        }

        // Alternar play/pause
        function togglePlay(deckNumber) {
            const deck = decks[deckNumber];
            const playBtn = document.getElementById(`play${deckNumber}`);
            const statusBadge = document.getElementById(`deckStatus${deckNumber}`);
            const container = document.getElementById(`deckContainer${deckNumber}`);
            
            if (!deck.audio) {
                alert(`Carregue um arquivo no Deck ${deckNumber} primeiro!`);
                return;
            }
            
            if (deck.isPlaying) {
                deck.audio.pause();
                deck.isPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.className = 'btn btn-primary';
                statusBadge.textContent = 'Pausado';
                statusBadge.className = 'badge bg-warning float-end';
                container.classList.remove('playing');
                console.log(`‚è∏Ô∏è Deck ${deckNumber} pausado`);
            } else {
                deck.audio.play();
                deck.isPlaying = true;
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playBtn.className = 'btn btn-warning';
                statusBadge.textContent = 'Tocando';
                statusBadge.className = 'badge bg-success float-end';
                container.classList.add('playing');
                console.log(`‚ñ∂Ô∏è Deck ${deckNumber} tocando`);
            }
        }

        // Parar reprodu√ß√£o
        function stop(deckNumber) {
            const deck = decks[deckNumber];
            const playBtn = document.getElementById(`play${deckNumber}`);
            const statusBadge = document.getElementById(`deckStatus${deckNumber}`);
            const container = document.getElementById(`deckContainer${deckNumber}`);
            
            if (deck.audio) {
                deck.audio.pause();
                deck.audio.currentTime = 0;
                deck.isPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.className = 'btn btn-primary';
                statusBadge.textContent = deck.file ? 'Carregado' : 'Vazio';
                statusBadge.className = deck.file ? 'badge bg-success float-end' : 'badge bg-secondary float-end';
                container.classList.remove('playing');
                console.log(`‚èπÔ∏è Deck ${deckNumber} parado`);
            }
        }

        // Definir volume do deck
        function setVolume(deckNumber, volume) {
            const deck = decks[deckNumber];
            deck.volume = parseFloat(volume);
            
            if (deck.audio) {
                deck.audio.volume = deck.volume * masterVolume;
            }
            
            document.getElementById(`volumeDisplay${deckNumber}`).textContent = `${Math.round(volume * 100)}%`;
            console.log(`üîä Volume Deck ${deckNumber}: ${Math.round(volume * 100)}%`);
        }

        // Definir volume geral
        function setMasterVolume(volume) {
            masterVolume = parseFloat(volume);
            document.getElementById('masterVolumeDisplay').textContent = `${Math.round(volume * 100)}%`;
            
            // Atualizar volume de todos os decks
            for (let i = 1; i <= 8; i++) {
                if (decks[i].audio) {
                    decks[i].audio.volume = decks[i].volume * masterVolume;
                }
            }
            
            console.log(`üîä Volume Geral: ${Math.round(volume * 100)}%`);
        }

        // Parar todos os decks
        function stopAll() {
            for (let i = 1; i <= 8; i++) {
                stop(i);
            }
            console.log('‚èπÔ∏è Todos os decks parados');
        }

        // Pausar todos os decks
        function pauseAll() {
            let pausedCount = 0;
            for (let i = 1; i <= 8; i++) {
                if (decks[i].isPlaying) {
                    togglePlay(i);
                    pausedCount++;
                }
            }
            console.log(`‚è∏Ô∏è ${pausedCount} deck(s) pausado(s)`);
        }

        // Encontrar deck dispon√≠vel
        function findAvailableDeck() {
            for (let i = 1; i <= 8; i++) {
                if (!decks[i].isPlaying) {
                    console.log(`‚úÖ Deck ${i} dispon√≠vel`);
                    return i;
                }
            }
            
            console.log('‚ö†Ô∏è Todos os decks ocupados, usando Deck 1');
            return 1;
        }

        // Carregar m√∫sica aleat√≥ria da playlist
        function loadRandom(deckNumber) {
            if (playlist.length === 0) {
                alert('Playlist vazia! Adicione m√∫sicas primeiro.');
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * playlist.length);
            const track = playlist[randomIndex];
            
            console.log(`üé≤ Carregando m√∫sica aleat√≥ria no Deck ${deckNumber}: ${track.title}`);
            loadFile(deckNumber, track.file);
        }

        // Carregar arquivos da playlist
        function loadPlaylistFiles() {
            const files = document.getElementById('playlistFiles').files;
            
            if (files.length === 0) {
                alert('Selecione arquivos de √°udio primeiro!');
                return;
            }
            
            console.log(`üìã Carregando ${files.length} arquivo(s) na playlist`);
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                playlist.push({
                    id: playlist.length,
                    title: file.name.replace(/\.[^/.]+$/, ""),
                    artist: "Artista Desconhecido",
                    file: file
                });
            }
            
            renderPlaylist();
            console.log(`‚úÖ Playlist atualizada com ${playlist.length} m√∫sica(s)`);
        }

        // Renderizar playlist
        function renderPlaylist() {
            const container = document.getElementById('playlistContainer');
            const status = document.getElementById('playlistStatus');
            
            if (playlist.length === 0) {
                container.innerHTML = '';
                status.innerHTML = 'Playlist vazia - Adicione m√∫sicas acima';
                status.className = 'alert alert-info';
                return;
            }
            
            status.innerHTML = `${playlist.length} m√∫sica(s) na playlist`;
            status.className = 'alert alert-success';
            
            let html = '<div class="row">';
            
            playlist.forEach((track, index) => {
                html += `
                    <div class="col-md-6 col-lg-4 col-xl-3 mb-3">
                        <div class="card bg-dark text-white">
                            <div class="card-body">
                                <h6 class="card-title">${track.title}</h6>
                                <p class="card-text small text-muted">${track.artist}</p>
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-sm btn-success" onclick="playFromPlaylist(${index})">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="loadToAvailableDeck(${index})">
                                        <i class="fas fa-upload"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="removeFromPlaylist(${index})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Carregar m√∫sica no deck dispon√≠vel
        function loadToAvailableDeck(index) {
            const track = playlist[index];
            const deckNumber = findAvailableDeck();
            
            console.log(`üéµ Carregando "${track.title}" no Deck ${deckNumber}`);
            loadFile(deckNumber, track.file);
        }

        // Tocar m√∫sica da playlist
        function playFromPlaylist(index) {
            const track = playlist[index];
            const deckNumber = findAvailableDeck();
            
            console.log(`üéµ Tocando "${track.title}" no Deck ${deckNumber}`);
            
            // Parar deck se estiver tocando
            if (decks[deckNumber].isPlaying) {
                stop(deckNumber);
            }
            
            // Carregar e tocar
            loadFile(deckNumber, track.file);
            
            setTimeout(() => {
                togglePlay(deckNumber);
            }, 500);
        }

        // Tocar pr√≥ximas 8 m√∫sicas
        function playNextSongs() {
            if (playlist.length === 0) {
                alert('Playlist vazia!');
                return;
            }
            
            console.log('üéµ Carregando pr√≥ximas 8 m√∫sicas nos decks...');
            
            // Parar todos primeiro
            stopAll();
            
            // Carregar uma m√∫sica em cada deck
            for (let i = 1; i <= 8 && i <= playlist.length; i++) {
                const trackIndex = (i - 1) % playlist.length;
                setTimeout(() => {
                    loadFile(i, playlist[trackIndex].file);
                    
                    // Tocar ap√≥s carregar
                    setTimeout(() => {
                        togglePlay(i);
                    }, 500);
                }, i * 200);
            }
        }

        // Remover m√∫sica da playlist
        function removeFromPlaylist(index) {
            playlist.splice(index, 1);
            renderPlaylist();
            console.log(`üóëÔ∏è M√∫sica removida da playlist`);
        }

        // Limpar playlist
        function clearPlaylist() {
            playlist = [];
            renderPlaylist();
            document.getElementById('playlistFiles').value = '';
            console.log('üóëÔ∏è Playlist limpa');
        }

        // Fun√ß√£o de teste do sistema
        function testSystem() {
            console.log('üîß === TESTE DO SISTEMA 8 DECKS ===');
            
            // Status geral
            let playingCount = 0;
            let loadedCount = 0;
            
            // Verificar cada deck
            for (let i = 1; i <= 8; i++) {
                const deck = decks[i];
                if (deck.audio) loadedCount++;
                if (deck.isPlaying) playingCount++;
                
                console.log(`üéõÔ∏è Deck ${i}:`, {
                    hasAudio: !!deck.audio,
                    isPlaying: deck.isPlaying,
                    hasFile: !!deck.file,
                    volume: `${Math.round(deck.volume * 100)}%`
                });
            }
            
            console.log(`üìä Resumo: ${loadedCount}/8 carregados, ${playingCount}/8 tocando`);
            
            // Verificar playlist
            console.log('üìã Playlist:', {
                count: playlist.length,
                tracks: playlist.slice(0, 5).map(t => t.title)
            });
            
            // Teste autom√°tico se playlist dispon√≠vel
            if (playlist.length >= 8) {
                console.log('üéµ Testando carregamento autom√°tico...');
                playNextSongs();
            } else if (playlist.length > 0) {
                console.log('üéµ Testando primeira m√∫sica...');
                playFromPlaylist(0);
            } else {
                console.log('‚ùå Playlist vazia - adicione m√∫sicas primeiro');
            }
            
            console.log('üîß === FIM DO TESTE ===');
        }

        // Formatar tempo
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Inicializar sistema
        document.addEventListener('DOMContentLoaded', function() {
            initializeDecks();
            console.log('üéµ Player 8 Decks inicializado!');
            console.log('üîß Para testar, execute: testSystem()');
        });
    </script>
</body>
</html>
